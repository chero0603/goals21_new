---
import IntersectionObserver from './IntersectionObserver.astro';
import FaqItem from './FaqItem.astro';

// FAQ データの配列
const faqData = [
  {
    question:
      '頻繁にインターネットバンキングのレイアウトが変わって困っている。',
    answer:
      '是非、継続管理サポートをご活用ください。都度サポートさせて頂きます。',
  },
  {
    question: '個人情報の提出が必要なんですか？',
    answer:
      '必須となっておりますので、秘密保持契約を締結後、サポートをさせて頂きます。',
  },
  {
    question: '地方に住んでいて、伺うことが難しい。',
    answer: 'お電話やオンラインでもサポートをしております。',
  },
  {
    question:
      'パスワードを間違えてしまい、インターネットバンキングへのログインがロックされてしまった',
    answer: 'ロック解除のお手続きをサポート致します。',
  },
  {
    question: '登録時に住所を現地にしていますが、大丈夫ですか？',
    answer:
      '居住証明ができないと、遠隔でのお手続きができないことがあります。まずはお問い合わせください。',
  },
  {
    question: '日本在住ではありませんが、サポートの依頼は可能でしょうか？',
    answer: 'お電話やオンラインでご対応致します。',
  },
  {
    question: '口座開設時に提出した、メールアドレスや電話番号が今は使えない。',
    answer: '登録情報変更のお手続きを行います。',
  },
  {
    question: 'カードの有効期限が切れている。',
    answer: '再発行手続きを行います。',
  },
  {
    question: '口座開設から時間が経ちすぎて登録情報がわからない。',
    answer: '銀行に架電して、確認しながらお手続きをサポート致します。',
  },
  {
    question: 'キャッシュカードをなくしてしまった。',
    answer: '再発行手続きを行います。',
  },
  {
    question: '現地にいかなくても、手続きは可能ですか？',
    answer:
      '現地渡航しなければならないケースもありますが、ほとんどのお手続きは日本国内からお手続きが可能です。',
  },
  {
    question: '法人口座でもサポートはしてもらえますか？',
    answer: 'サポート可能です。',
  },
];
---

<section
  id="faq"
  aria-labelledby="faq-heading"
  itemscope
  itemtype="https://schema.org/FAQPage"
  class="bg-gradient-to-br from-gray-50 to-gray-100 py-6 sm:py-12"
>
  <div class="mx-auto max-w-6xl px-4">
    <IntersectionObserver
      class="data-[observer=true]:animate-fade-in-up-800 delay-order-child opacity-0"
    >
      <h2
        id="faq-heading"
        class="from-primary-500 to-primary-700 mb-8 bg-gradient-to-r bg-clip-text text-center text-[5.7vw] font-bold text-transparent sm:mb-12 sm:text-4xl lg:text-5xl"
      >
        よくあるご質問
      </h2>
      <p
        class="mx-auto mb-8 max-w-2xl text-center text-lg text-gray-600 sm:mb-12 sm:text-lg"
      >
        お客様からよくいただくご質問をまとめました。
        <br class="hidden sm:inline" />
        その他のご質問はお気軽にお問い合わせください。
      </p>
    </IntersectionObserver>

    <div class="mx-auto max-w-4xl space-y-4">
      {
        faqData.map(faq => (
          <FaqItem question={faq.question} answer={faq.answer} />
        ))
      }
    </div>

    <!-- CTA Section -->
    <IntersectionObserver
      class="data-[observer=true]:animate-fade-in-up-800 animate-order-child opacity-0"
    >
      <div class="mt-12 text-center">
        <h3
          class="from-primary-600 to-primary-800 bg-gradient-to-r bg-clip-text text-lg font-bold text-transparent sm:text-2xl"
        >
          その他のご質問や
          <br class="inline sm:hidden" />
          お困りごとがございましたら
          <br class="inline sm:hidden" />
          お気軽にお問い合わせください
        </h3>
        <p class="mt-2 text-lg text-gray-600">
          専門スタッフが
          <br class="inline sm:hidden" />
          丁寧にお答えいたします
        </p>
      </div>
    </IntersectionObserver>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const faqItems = document.querySelectorAll('.faq-item');

    faqItems.forEach(item => {
      const question = item.querySelector('.faq-question');
      const answer = item.querySelector('.faq-answer');
      const icon = item.querySelector('.faq-icon');

      if (!question || !answer || !icon) return;

      question.addEventListener('click', () => {
        const isExpanded = question.getAttribute('aria-expanded') === 'true';

        // Close all other items
        faqItems.forEach(otherItem => {
          if (otherItem !== item) {
            const otherQuestion = otherItem.querySelector('.faq-question');
            const otherAnswer = otherItem.querySelector('.faq-answer');
            const otherIcon = otherItem.querySelector('.faq-icon');

            if (otherQuestion && otherAnswer && otherIcon) {
              otherQuestion.setAttribute('aria-expanded', 'false');
              otherAnswer.setAttribute('data-open', 'false');
              otherIcon.setAttribute('data-open', 'false');
            }
          }
        });

        // Toggle current item (no inline styles)
        const nextState = isExpanded ? 'false' : 'true';
        question.setAttribute('aria-expanded', nextState);
        answer.setAttribute('data-open', nextState);
        icon.setAttribute('data-open', nextState);
      });
    });
  });
</script>
